<Project Sdk="Microsoft.NET.Sdk.Web">

    <PropertyGroup>
        <TargetFramework>netcoreapp2.2</TargetFramework>
        <UserSecretsId>bw</UserSecretsId>
    </PropertyGroup>

    <ItemGroup>
        <Folder Include="wwwroot\" />
    </ItemGroup>

    <ItemGroup>
        <PackageReference Include="Microsoft.AspNetCore.App" />
    </ItemGroup>
    <Choose>
        <When Condition="Exists('..\..\..\BioEngine.Core.Infra')">
            <ItemGroup>
                <ProjectReference Include="..\..\..\BioEngine.Core.Infra\src\BioEngine.Core.Infra\BioEngine.Core.Infra.csproj" />
            </ItemGroup>
        </When>
        <Otherwise>
            <ItemGroup>
                <PackageReference Include="BioEngine.Core.Infra" Version="3.0.*" />
            </ItemGroup>
        </Otherwise>
    </Choose>
    <Choose>
        <When Condition="Exists('..\..\..\BioEngine.Core.Site')">
            <ItemGroup>
                <ProjectReference Include="..\..\..\BioEngine.Core.Site\src\BioEngine.Core.Site\BioEngine.Core.Site.csproj" />
            </ItemGroup>
        </When>
        <Otherwise>
            <ItemGroup>
                <PackageReference Include="BioEngine.Core.Site" Version="3.0.*" />
            </ItemGroup>
        </Otherwise>
    </Choose>
    <Choose>
        <When Condition="Exists('..\..\..\BioEngine.BRC.Domain')">
            <ItemGroup>
                <ProjectReference Include="..\..\..\BioEngine.BRC.Domain\src\BioEngine.BRC.Domain\BioEngine.BRC.Domain.csproj" />
            </ItemGroup>
        </When>
        <Otherwise>
            <ItemGroup>
                <PackageReference Include="BioEngine.BRC.Domain" Version="3.0.*" />
            </ItemGroup>
        </Otherwise>
    </Choose>
    <Choose>
        <When Condition="Exists('..\..\..\BioEngine.Extra.IPB')">
            <ItemGroup>
                <ProjectReference Include="..\..\..\BioEngine.Extra.IPB\src\BioEngine.Extra.IPB\BioEngine.Extra.IPB.csproj" />
            </ItemGroup>
        </When>
        <Otherwise>
            <ItemGroup>
                <PackageReference Include="BioEngine.Extra.IPB" Version="3.0.*" />
            </ItemGroup>
        </Otherwise>
    </Choose>
    <ItemGroup>
        <WebpackInputs Include="Web\**\*" />
        <WebpackInputs Include="webpack.config.ts" />
    </ItemGroup>
    <ItemGroup>
        <WebpackOutputs Include="wwwroot\assets\**\*" />
        <WebpackOutputs Include="wwwroot\css\**\*" />
        <WebpackOutputs Include="wwwroot\js\**\*" />
    </ItemGroup>
    <ItemGroup>
        <MvcRazorFilesToCompile Include="Views\**\*.cshtml" />
    </ItemGroup>
    <ItemGroup>
      <_ContentIncludedByDefault Remove="Views\Components\Menu\Default.cshtml" />
    </ItemGroup>
    <ItemGroup>
      <Content Include="Web\css\blocks.less" />
      <Content Include="Web\css\blocks\youtube.less" />
      <Content Include="Web\js\common\header.ts" />
    </ItemGroup>
    <ItemGroup>
      <TypeScriptCompile Include="Web\js\common\blocks\youtube.ts" />
    </ItemGroup>
    <Target Condition=" '$(Configuration)' == 'Debug' " Name="BuildClientAssetsDebug" BeforeTargets="BeforeBuild" Inputs="@(WebpackInputs)" Outputs="@(WebpackOutputs)">
        <Exec Command="node_modules\.bin\webpack --progress --mode development" />
        <ItemGroup>
            <MvcRazorFilesToCompile Include="Views\Shared\Assets\*.cshtml" />
        </ItemGroup>
    </Target>
    <Target Condition=" '$(Configuration)' == 'Release' " Name="BuildClientAssetsRelease" BeforeTargets="BeforeBuild">
        <Exec Command="npm install" />
        <Exec Command="node_modules\.bin\webpack --mode production" />
        <ItemGroup>
            <MvcRazorFilesToCompile Include="Views\Shared\Assets\*.cshtml" />
        </ItemGroup>
    </Target>
</Project>
