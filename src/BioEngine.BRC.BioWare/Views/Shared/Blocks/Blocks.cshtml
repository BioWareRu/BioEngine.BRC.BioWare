@using BioEngine.Core.Entities.Blocks
@using BioEngine.Core.Site.Model
@model BioEngine.Core.Site.Model.ContentEntityViewModel
@{

    foreach (var block in Model.Item.Blocks.OrderBy(b => b.Position))
    {
        if (block is CutBlock)
        {
            if (Model.Mode == ContentViewMode.Full)
            {
                continue;
            }
        }

        var modelType = typeof(BlockViewModel<,>).MakeGenericType(block.GetType(), block.GetData().GetType());
        var model = Activator.CreateInstance(modelType, block, Model.Item);
        <div class="block block-@block.Type">
            @{
                await Html.RenderPartialAsync($"Blocks/{block.Type}", model);
            }
        </div>
        if (block is CutBlock)
        {
            if (Model.Mode == ContentViewMode.Short)
            {
                break;
            }
        }
    }
}
